{"ast":null,"code":"import CouponModal from '@/components/CouponModal.vue';\nimport DelModal from '@/components/DelModal.vue';\nimport useJwt from '@/composables/useJwt'; // 引入 useJwt\n\nexport default {\n  components: {\n    CouponModal,\n    DelModal\n  },\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {\n        title: '',\n        is_enabled: true,\n        percent: 100,\n        code: '',\n        due_date: new Date().toISOString().split('T')[0]\n      },\n      isNew: false,\n      minPercent: null,\n      maxPercent: null\n    };\n  },\n  methods: {\n    // 使用 useJwt\n    ...useJwt(),\n    // 解構 useJwt 返回的所有方法\n\n    openCouponModal(isNew, item) {\n      this.isNew = isNew;\n      if (this.isNew) {\n        this.tempCoupon = {\n          title: '',\n          is_enabled: true,\n          percent: 100,\n          code: '',\n          due_date: new Date().toISOString().split('T')[0]\n        };\n      } else {\n        this.tempCoupon = {\n          ...item\n        };\n      }\n      this.$refs.couponModal.showModal();\n    },\n    openDelCouponModal(item) {\n      this.tempCoupon = {\n        ...item\n      };\n      this.$refs.delModal.showModal();\n    },\n    getCoupons() {\n      const url = `/api/coupons`;\n      const token = this.getToken(); // 使用 useJwt 的 getToken 方法\n\n      // 使用 token 在這裡進行身份驗證，例如在 headers 中添加 Authorization\n      this.$http.get(url, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(response => {\n        this.coupons = response.data.map(coupon => ({\n          ...coupon,\n          due_date: coupon.dueDate\n        }));\n      });\n    },\n    formatDate(timestamp) {\n      const date = new Date(timestamp);\n      return date.toLocaleDateString();\n    },\n    updateOrCreateCoupon(coupon) {\n      if (this.isNew) {\n        this.createCoupon(coupon);\n      } else {\n        this.updateCoupon(coupon);\n      }\n    },\n    createCoupon(newCoupon) {\n      const api = `/api/coupons`;\n      this.$http.post(api, newCoupon).then(response => {\n        this.getCoupons();\n        this.$refs.couponModal.hideModal();\n      });\n    },\n    updateCoupon(updatedCoupon) {\n      const api = `/api/coupons/${updatedCoupon.id}`;\n      this.$http.put(api, updatedCoupon).then(response => {\n        this.getCoupons();\n        this.$refs.couponModal.hideModal();\n      });\n    },\n    delCoupon() {\n      const api = `/api/coupons/${this.tempCoupon.id}`;\n      this.$http.delete(api).then(() => {\n        this.getCoupons();\n        this.$refs.delModal.hideModal();\n      });\n    },\n    getCouponsByPercentRange() {\n      const api = `/api/coupons/percent-range?minPercent=${this.minPercent}&maxPercent=${this.maxPercent}`;\n      this.$http.get(api).then(response => {\n        this.coupons = response.data.map(coupon => ({\n          ...coupon,\n          due_date: coupon.dueDate\n        }));\n      });\n    }\n  },\n  created() {\n    this.getCoupons();\n  }\n};","map":{"version":3,"names":["CouponModal","DelModal","useJwt","components","data","coupons","tempCoupon","title","is_enabled","percent","code","due_date","Date","toISOString","split","isNew","minPercent","maxPercent","methods","openCouponModal","item","$refs","couponModal","showModal","openDelCouponModal","delModal","getCoupons","url","token","getToken","$http","get","headers","then","response","map","coupon","dueDate","formatDate","timestamp","date","toLocaleDateString","updateOrCreateCoupon","createCoupon","updateCoupon","newCoupon","api","post","hideModal","updatedCoupon","id","put","delCoupon","delete","getCouponsByPercentRange","created"],"sources":["/Users/foxyy/Desktop/寫好的/電商spring+vue3 final/ijrgoer/src/views/Coupons.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- Form for Percentage Range Search -->\n    <div class=\"mb-4\">\n      <label for=\"minPercent\">最小百分比: </label>\n      <input type=\"number\" id=\"minPercent\" v-model=\"minPercent\">\n      <label for=\"maxPercent\">最大百分比: </label>\n      <input type=\"number\" id=\"maxPercent\" v-model=\"maxPercent\">\n      <button @click=\"getCouponsByPercentRange\">搜索</button>\n    </div>\n\n    <div class=\"text-end mt-4\">\n      <button class=\"btn btn-primary\" @click=\"openCouponModal(true)\">\n        建立新的優惠券\n      </button>\n    </div>\n\n    <table class=\"table mt-4\">\n      <thead>\n        <tr>\n          <th>名稱</th>\n          <th>折扣百分比</th>\n          <th>到期日</th>\n          <th>是否啟用</th>\n          <th>編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"(item, key) in coupons\" :key=\"key\">\n          <td>{{ item.title }}</td>\n          <td>{{ item.percent }}%</td>\n          <td>{{ formatDate(item.due_date) }}</td>\n          <td>\n            <span v-if=\"item.is_enabled\" class=\"text-success\">啟用</span>\n            <span v-else class=\"text-muted\">未啟用</span>\n          </td>\n          <td>\n            <div class=\"btn-group\">\n              <button class=\"btn btn-outline-primary btn-sm\" @click=\"openCouponModal(false, item)\">編輯</button>\n              <button class=\"btn btn-outline-danger btn-sm\" @click=\"openDelCouponModal(item)\">刪除</button>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n\n    <couponModal :coupon=\"tempCoupon\" ref=\"couponModal\" @update-coupon=\"updateOrCreateCoupon\" />\n    <DelModal :item=\"tempCoupon\" ref=\"delModal\" @del-item=\"delCoupon\" />\n  </div>\n</template>\n\n\n<script>\nimport CouponModal from '@/components/CouponModal.vue';\nimport DelModal from '@/components/DelModal.vue';\nimport useJwt from '@/composables/useJwt'; // 引入 useJwt\n\nexport default {\n  components: { CouponModal, DelModal },\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {\n        title: '',\n        is_enabled: true,\n        percent: 100,\n        code: '',\n        due_date: new Date().toISOString().split('T')[0],\n      },\n      isNew: false,\n      minPercent: null,\n      maxPercent: null\n    };\n  },\n  methods: {\n    // 使用 useJwt\n    ...useJwt(),  // 解構 useJwt 返回的所有方法\n\n    openCouponModal(isNew, item) {\n      this.isNew = isNew;\n      if (this.isNew) {\n        this.tempCoupon = {\n          title: '',\n          is_enabled: true,\n          percent: 100,\n          code: '',\n          due_date: new Date().toISOString().split('T')[0],\n        };\n      } else {\n        this.tempCoupon = { ...item };\n      }\n      this.$refs.couponModal.showModal();\n    },\n\n    openDelCouponModal(item) {\n      this.tempCoupon = { ...item };\n      this.$refs.delModal.showModal();\n    },\n\n    getCoupons() {\n      const url = `/api/coupons`;\n      const token = this.getToken(); // 使用 useJwt 的 getToken 方法\n      \n      // 使用 token 在這裡進行身份驗證，例如在 headers 中添加 Authorization\n      this.$http.get(url, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then((response) => {\n        this.coupons = response.data.map(coupon => ({\n          ...coupon,\n          due_date: coupon.dueDate\n        }));\n      });\n    },\n\n    formatDate(timestamp) {\n      const date = new Date(timestamp);\n      return date.toLocaleDateString();\n    },\n\n    updateOrCreateCoupon(coupon) {\n      if (this.isNew) {\n        this.createCoupon(coupon);\n      } else {\n        this.updateCoupon(coupon);\n      }\n    },\n\n    createCoupon(newCoupon) {\n      const api = `/api/coupons`;\n      this.$http.post(api, newCoupon).then((response) => {\n        this.getCoupons();\n        this.$refs.couponModal.hideModal();\n      });\n    },\n\n    updateCoupon(updatedCoupon) {\n      const api = `/api/coupons/${updatedCoupon.id}`;\n      this.$http.put(api, updatedCoupon).then((response) => {\n        this.getCoupons();\n        this.$refs.couponModal.hideModal();\n      });\n    },\n\n    delCoupon() {\n      const api = `/api/coupons/${this.tempCoupon.id}`;\n      this.$http.delete(api).then(() => {\n        this.getCoupons();\n        this.$refs.delModal.hideModal();\n      });\n    },\n\n    getCouponsByPercentRange() {\n      const api = `/api/coupons/percent-range?minPercent=${this.minPercent}&maxPercent=${this.maxPercent}`;\n      this.$http.get(api).then((response) => {\n        this.coupons = response.data.map(coupon => ({\n          ...coupon,\n          due_date: coupon.dueDate\n        }));\n      });\n    }\n  },\n  created() {\n    this.getCoupons();\n  },\n};\n\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
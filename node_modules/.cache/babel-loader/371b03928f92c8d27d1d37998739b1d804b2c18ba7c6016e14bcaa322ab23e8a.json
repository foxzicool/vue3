{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeClass as _normalizeClass, withCtx as _withCtx } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"row mt-4\"\n};\nconst _hoisted_3 = {\n  class: \"col-md-7\"\n};\nconst _hoisted_4 = {\n  class: \"table align-middle\"\n};\nconst _hoisted_5 = /*#__PURE__*/_createElementVNode(\"thead\", null, [/*#__PURE__*/_createElementVNode(\"tr\", null, [/*#__PURE__*/_createElementVNode(\"th\", null, \"商品名稱\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"價格\"), /*#__PURE__*/_createElementVNode(\"th\")])], -1 /* HOISTED */);\nconst _hoisted_6 = {\n  href: \"#\",\n  class: \"text-dark\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"h5\"\n};\nconst _hoisted_8 = {\n  key: 1,\n  class: \"h6\"\n};\nconst _hoisted_9 = {\n  key: 2,\n  class: \"h5\"\n};\nconst _hoisted_10 = {\n  class: \"btn-group btn-group-sm\"\n};\nconst _hoisted_11 = [\"onClick\"];\nconst _hoisted_12 = [\"disabled\", \"onClick\"];\nconst _hoisted_13 = {\n  key: 0,\n  class: \"spinner-grow text-danger spinner-grow-sm\",\n  role: \"status\"\n};\nconst _hoisted_14 = /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"visually-hidden\"\n}, \"Loading...\", -1 /* HOISTED */);\nconst _hoisted_15 = [_hoisted_14];\nconst _hoisted_16 = {\n  class: \"col-md-5\"\n};\nconst _hoisted_17 = {\n  class: \"sticky-top\"\n};\nconst _hoisted_18 = {\n  class: \"table align-middle\"\n};\nconst _hoisted_19 = /*#__PURE__*/_createElementVNode(\"thead\", null, [/*#__PURE__*/_createElementVNode(\"tr\", null, [/*#__PURE__*/_createElementVNode(\"th\", null, \"品名\"), /*#__PURE__*/_createElementVNode(\"th\", {\n  style: {\n    \"width\": \"110px\"\n  }\n}, \"數量\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"單價\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"總價\")])], -1 /* HOISTED */);\nconst _hoisted_20 = {\n  class: \"input-group input-group-sm\"\n};\nconst _hoisted_21 = [\"onUpdate:modelValue\", \"onChange\"];\nconst _hoisted_22 = {\n  class: \"input-group-text\"\n};\nconst _hoisted_23 = /*#__PURE__*/_createElementVNode(\"td\", {\n  colspan: \"3\",\n  class: \"text-end\"\n}, \"總計\", -1 /* HOISTED */);\nconst _hoisted_24 = {\n  class: \"text-end\"\n};\nconst _hoisted_25 = {\n  key: 0\n};\nconst _hoisted_26 = /*#__PURE__*/_createElementVNode(\"td\", {\n  colspan: \"3\",\n  class: \"text-end text-success\"\n}, \"折扣價\", -1 /* HOISTED */);\nconst _hoisted_27 = {\n  class: \"text-end text-success\"\n};\nconst _hoisted_28 = {\n  class: \"input-group mb-3 input-group-sm\"\n};\nconst _hoisted_29 = {\n  class: \"input-group-append\"\n};\nconst _hoisted_30 = {\n  class: \"my-5 row justify-content-center\"\n};\nconst _hoisted_31 = {\n  class: \"mb-3\"\n};\nconst _hoisted_32 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"email\",\n  class: \"form-label\"\n}, \"Email\", -1 /* HOISTED */);\nconst _hoisted_33 = {\n  class: \"mb-3\"\n};\nconst _hoisted_34 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"name\",\n  class: \"form-label\"\n}, \"收件人姓名\", -1 /* HOISTED */);\nconst _hoisted_35 = {\n  class: \"mb-3\"\n};\nconst _hoisted_36 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"tel\",\n  class: \"form-label\"\n}, \"收件人電話\", -1 /* HOISTED */);\nconst _hoisted_37 = {\n  class: \"mb-3\"\n};\nconst _hoisted_38 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"address\",\n  class: \"form-label\"\n}, \"收件人地址\", -1 /* HOISTED */);\nconst _hoisted_39 = {\n  class: \"mb-3\"\n};\nconst _hoisted_40 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"message\",\n  class: \"form-label\"\n}, \"留言\", -1 /* HOISTED */);\nconst _hoisted_41 = /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"text-end\"\n}, [/*#__PURE__*/_createElementVNode(\"button\", {\n  class: \"btn btn-danger\"\n}, \"送出訂單\")], -1 /* HOISTED */);\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Loading = _resolveComponent(\"Loading\");\n  const _component_Field = _resolveComponent(\"Field\");\n  const _component_ErrorMessage = _resolveComponent(\"ErrorMessage\");\n  const _component_Form = _resolveComponent(\"Form\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_Loading, {\n    active: _ctx.isLoading\n  }, null, 8 /* PROPS */, [\"active\"]), _createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"table\", _hoisted_4, [_hoisted_5, _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.products, item => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: item.id\n    }, [_createElementVNode(\"td\", null, [_createElementVNode(\"a\", _hoisted_6, _toDisplayString(item.title), 1 /* TEXT */)]), _createElementVNode(\"td\", null, [!item.price ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, _toDisplayString(item.origin_price) + \" 元 \", 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), item.price ? (_openBlock(), _createElementBlock(\"del\", _hoisted_8, \" 原價 \" + _toDisplayString(item.origin_price) + \" 元 \", 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), item.price ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \" 現在只要 \" + _toDisplayString(item.price) + \" 元 \", 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"td\", null, [_createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn btn-outline-secondary\",\n      onClick: $event => $options.getProduct(item.id)\n    }, \" 查看更多 \", 8 /* PROPS */, _hoisted_11), _createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn btn-outline-danger\",\n      disabled: this.status.loadingItem === item.id,\n      onClick: $event => $options.addCart(item.id)\n    }, [this.status.loadingItem === item.id ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, _hoisted_15)) : _createCommentVNode(\"v-if\", true), _createTextVNode(\" 加到購物車 \")], 8 /* PROPS */, _hoisted_12)])])]);\n  }), 128 /* KEYED_FRAGMENT */))])])]), _createCommentVNode(\" 購物車列表 \"), _createElementVNode(\"div\", _hoisted_16, [_createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"table\", _hoisted_18, [_hoisted_19, _createElementVNode(\"tbody\", null, [$data.cart.items.length ? (_openBlock(true), _createElementBlock(_Fragment, {\n    key: 0\n  }, _renderList($data.cart.items, item => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: item.product.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(item.product.title), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createElementVNode(\"div\", _hoisted_20, [_withDirectives(_createElementVNode(\"input\", {\n      type: \"number\",\n      class: \"form-control\",\n      min: \"1\",\n      \"onUpdate:modelValue\": $event => item.qty = $event,\n      onChange: $event => $options.updateCartQuantityByProductId(item.product.id, item.qty)\n    }, null, 40 /* PROPS, HYDRATE_EVENTS */, _hoisted_21), [[_vModelText, item.qty, void 0, {\n      number: true\n    }]]), _createElementVNode(\"div\", _hoisted_22, \" / \" + _toDisplayString(item.product.unit), 1 /* TEXT */)])]), _createElementVNode(\"td\", null, _toDisplayString(item.product.price) + \" 元\", 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(item.product.price * item.qty) + \" 元\", 1 /* TEXT */)]);\n  }), 128 /* KEYED_FRAGMENT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"tfoot\", null, [_createElementVNode(\"tr\", null, [_hoisted_23, _createElementVNode(\"td\", _hoisted_24, _toDisplayString(_ctx.$filters.currency($data.cart.total)), 1 /* TEXT */)]), $data.cart.final_total !== $data.cart.total ? (_openBlock(), _createElementBlock(\"tr\", _hoisted_25, [_hoisted_26, _createElementVNode(\"td\", _hoisted_27, _toDisplayString(_ctx.$filters.currency($data.cart.final_total)), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)])]), _createElementVNode(\"div\", _hoisted_28, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    class: \"form-control\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.coupon_code = $event),\n    placeholder: \"請輸入優惠碼\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.coupon_code]]), _createElementVNode(\"div\", _hoisted_29, [_createElementVNode(\"button\", {\n    class: \"btn btn-outline-secondary\",\n    type: \"button\",\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.addCouponCode && $options.addCouponCode(...args))\n  }, \" 套用優惠碼 \")])])])])]), _createElementVNode(\"div\", _hoisted_30, [_createVNode(_component_Form, {\n    class: \"col-md-6\",\n    onSubmit: $options.createOrder\n  }, {\n    default: _withCtx(({\n      errors\n    }) => [_createElementVNode(\"div\", _hoisted_31, [_hoisted_32, _createVNode(_component_Field, {\n      id: \"email\",\n      name: \"email\",\n      type: \"email\",\n      class: _normalizeClass([\"form-control\", {\n        'is-invalid': errors['email']\n      }]),\n      placeholder: \"請輸入 Email\",\n      rules: \"email|required\",\n      modelValue: $data.form.user.email,\n      \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.form.user.email = $event)\n    }, null, 8 /* PROPS */, [\"class\", \"modelValue\"]), _createVNode(_component_ErrorMessage, {\n      name: \"email\",\n      class: \"invalid-feedback\"\n    })]), _createElementVNode(\"div\", _hoisted_33, [_hoisted_34, _createVNode(_component_Field, {\n      id: \"name\",\n      name: \"姓名\",\n      type: \"text\",\n      class: _normalizeClass([\"form-control\", {\n        'is-invalid': errors['姓名']\n      }]),\n      placeholder: \"請輸入姓名\",\n      rules: \"required\",\n      modelValue: $data.form.user.name,\n      \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.form.user.name = $event)\n    }, null, 8 /* PROPS */, [\"class\", \"modelValue\"]), _createVNode(_component_ErrorMessage, {\n      name: \"姓名\",\n      class: \"invalid-feedback\"\n    })]), _createElementVNode(\"div\", _hoisted_35, [_hoisted_36, _createVNode(_component_Field, {\n      id: \"tel\",\n      name: \"電話\",\n      type: \"tel\",\n      class: _normalizeClass([\"form-control\", {\n        'is-invalid': errors['電話']\n      }]),\n      placeholder: \"請輸入電話\",\n      rules: \"required\",\n      modelValue: $data.form.user.tel,\n      \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $data.form.user.tel = $event)\n    }, null, 8 /* PROPS */, [\"class\", \"modelValue\"]), _createVNode(_component_ErrorMessage, {\n      name: \"電話\",\n      class: \"invalid-feedback\"\n    })]), _createElementVNode(\"div\", _hoisted_37, [_hoisted_38, _createVNode(_component_Field, {\n      id: \"address\",\n      name: \"地址\",\n      type: \"text\",\n      class: _normalizeClass([\"form-control\", {\n        'is-invalid': errors['地址']\n      }]),\n      placeholder: \"請輸入地址\",\n      rules: \"required\",\n      modelValue: $data.form.user.address,\n      \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $data.form.user.address = $event)\n    }, null, 8 /* PROPS */, [\"class\", \"modelValue\"]), _createVNode(_component_ErrorMessage, {\n      name: \"地址\",\n      class: \"invalid-feedback\"\n    })]), _createElementVNode(\"div\", _hoisted_39, [_hoisted_40, _withDirectives(_createElementVNode(\"textarea\", {\n      name: \"\",\n      id: \"message\",\n      class: \"form-control\",\n      cols: \"30\",\n      rows: \"10\",\n      \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => $data.form.message = $event)\n    }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.message]])]), _hoisted_41]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onSubmit\"])])])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createElementVNode","href","role","_hoisted_14","style","colspan","for","_createVNode","_component_Loading","active","_ctx","isLoading","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_createElementBlock","_Fragment","_renderList","$data","products","item","key","id","_hoisted_6","_toDisplayString","title","price","_hoisted_7","origin_price","_hoisted_8","_hoisted_9","_hoisted_10","type","onClick","$event","$options","getProduct","_hoisted_11","disabled","status","loadingItem","addCart","_hoisted_13","_hoisted_15","_createCommentVNode","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","cart","items","length","product","_hoisted_20","min","qty","onChange","updateCartQuantityByProductId","_hoisted_22","unit","_hoisted_23","_hoisted_24","$filters","currency","total","final_total","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","coupon_code","placeholder","_hoisted_29","_cache","args","addCouponCode","_hoisted_30","_component_Form","onSubmit","createOrder","errors","_hoisted_31","_hoisted_32","_component_Field","name","_normalizeClass","rules","form","user","email","_component_ErrorMessage","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","tel","_hoisted_37","_hoisted_38","address","_hoisted_39","_hoisted_40","cols","rows","message","_hoisted_41"],"sources":["C:\\Users\\2409\\Desktop\\vue3最新\\vue3\\src\\views\\UserCart.vue"],"sourcesContent":["<template>\r\n  <Loading :active=\"isLoading\"></Loading>\r\n  <div class=\"container\">\r\n    <div class=\"row mt-4\">\r\n      <div class=\"col-md-7\">\r\n        <table class=\"table align-middle\">\r\n          <thead>\r\n            <tr>\r\n              <th>商品名稱</th>\r\n              <th>價格</th>\r\n              <th></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"item in products\" :key=\"item.id\">\r\n              <td>\r\n                <a href=\"#\" class=\"text-dark\">{{ item.title }}</a>\r\n              </td>\r\n              <td>\r\n                <div class=\"h5\" v-if=\"!item.price\">\r\n                  {{ item.origin_price }} 元\r\n                </div>\r\n                <del class=\"h6\" v-if=\"item.price\">\r\n                  原價 {{ item.origin_price }} 元\r\n                </del>\r\n                <div class=\"h5\" v-if=\"item.price\">\r\n                  現在只要 {{ item.price }} 元\r\n                </div>\r\n              </td>\r\n              <td>\r\n                <div class=\"btn-group btn-group-sm\">\r\n                  <button\r\n                    type=\"button\"\r\n                    class=\"btn btn-outline-secondary\"\r\n                    @click=\"getProduct(item.id)\"\r\n                  >\r\n                    查看更多\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    class=\"btn btn-outline-danger\"\r\n                    :disabled=\"this.status.loadingItem === item.id\"\r\n                    @click=\"addCart(item.id)\"\r\n                  >\r\n                    <div\r\n                      v-if=\"this.status.loadingItem === item.id\"\r\n                      class=\"spinner-grow text-danger spinner-grow-sm\"\r\n                      role=\"status\"\r\n                    >\r\n                      <span class=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                    加到購物車\r\n                  </button>\r\n                </div>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <!-- 購物車列表 -->\r\n      <div class=\"col-md-5\">\r\n        <div class=\"sticky-top\">\r\n            <table class=\"table align-middle\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>品名</th>\r\n                        <th style=\"width: 110px\">數量</th>\r\n                        <th>單價</th>\r\n                        <th>總價</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                  <template v-if=\"cart.items.length\">\r\n                    <tr v-for=\"item in cart.items\" :key=\"item.product.id\">\r\n                      <td>{{ item.product.title }}</td>\r\n                      <td>\r\n                        <div class=\"input-group input-group-sm\">\r\n                          <input\r\n                            type=\"number\"\r\n                            class=\"form-control\"\r\n                            min=\"1\"\r\n                            v-model.number=\"item.qty\"\r\n                            @change=\"updateCartQuantityByProductId(item.product.id, item.qty)\"\r\n                          />\r\n                          <div class=\"input-group-text\">\r\n                            / {{ item.product.unit }}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td>{{ item.product.price }} 元</td>\r\n                      <td>{{ item.product.price * item.qty }} 元</td>\r\n                    </tr>\r\n                  </template>\r\n                </tbody>\r\n                <tfoot>\r\n                    <tr>\r\n                        <td colspan=\"3\" class=\"text-end\">總計</td>\r\n                        <td class=\"text-end\">{{ $filters.currency(cart.total) }}</td>\r\n                    </tr>\r\n                    <tr v-if=\"cart.final_total !== cart.total\">\r\n                        <td colspan=\"3\" class=\"text-end text-success\">折扣價</td>\r\n                        <td class=\"text-end text-success\">\r\n                            {{ $filters.currency(cart.final_total) }}\r\n                        </td>\r\n                    </tr>\r\n                </tfoot>\r\n            </table>\r\n            <div class=\"input-group mb-3 input-group-sm\">\r\n                <input\r\n                  type=\"text\"\r\n                  class=\"form-control\"\r\n                  v-model=\"coupon_code\"\r\n                  placeholder=\"請輸入優惠碼\"\r\n                />\r\n                <div class=\"input-group-append\">\r\n                    <button\r\n                      class=\"btn btn-outline-secondary\"\r\n                      type=\"button\"\r\n                      @click=\"addCouponCode\"\r\n                    >\r\n                      套用優惠碼\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    </div>\r\n\r\n    <div class=\"my-5 row justify-content-center\">\r\n      <Form class=\"col-md-6\" v-slot=\"{ errors }\" @submit=\"createOrder\">\r\n        <div class=\"mb-3\">\r\n          <label for=\"email\" class=\"form-label\">Email</label>\r\n          <Field\r\n            id=\"email\"\r\n            name=\"email\"\r\n            type=\"email\"\r\n            class=\"form-control\"\r\n            :class=\"{ 'is-invalid': errors['email'] }\"\r\n            placeholder=\"請輸入 Email\"\r\n            rules=\"email|required\"\r\n            v-model=\"form.user.email\"\r\n          ></Field>\r\n          <ErrorMessage name=\"email\" class=\"invalid-feedback\"></ErrorMessage>\r\n        </div>\r\n\r\n        <div class=\"mb-3\">\r\n          <label for=\"name\" class=\"form-label\">收件人姓名</label>\r\n          <Field\r\n            id=\"name\"\r\n            name=\"姓名\"\r\n            type=\"text\"\r\n            class=\"form-control\"\r\n            :class=\"{ 'is-invalid': errors['姓名'] }\"\r\n            placeholder=\"請輸入姓名\"\r\n            rules=\"required\"\r\n            v-model=\"form.user.name\"\r\n          ></Field>\r\n          <ErrorMessage name=\"姓名\" class=\"invalid-feedback\"></ErrorMessage>\r\n        </div>\r\n\r\n        <div class=\"mb-3\">\r\n          <label for=\"tel\" class=\"form-label\">收件人電話</label>\r\n          <Field\r\n            id=\"tel\"\r\n            name=\"電話\"\r\n            type=\"tel\"\r\n            class=\"form-control\"\r\n            :class=\"{ 'is-invalid': errors['電話'] }\"\r\n            placeholder=\"請輸入電話\"\r\n            rules=\"required\"\r\n            v-model=\"form.user.tel\"\r\n          ></Field>\r\n          <ErrorMessage name=\"電話\" class=\"invalid-feedback\"></ErrorMessage>\r\n        </div>\r\n\r\n        <div class=\"mb-3\">\r\n          <label for=\"address\" class=\"form-label\">收件人地址</label>\r\n          <Field\r\n            id=\"address\"\r\n            name=\"地址\"\r\n            type=\"text\"\r\n            class=\"form-control\"\r\n            :class=\"{ 'is-invalid': errors['地址'] }\"\r\n            placeholder=\"請輸入地址\"\r\n            rules=\"required\"\r\n            v-model=\"form.user.address\"\r\n          ></Field>\r\n          <ErrorMessage name=\"地址\" class=\"invalid-feedback\"></ErrorMessage>\r\n        </div>\r\n\r\n        <div class=\"mb-3\">\r\n          <label for=\"message\" class=\"form-label\">留言</label>\r\n          <textarea\r\n            name=\"\"\r\n            id=\"message\"\r\n            class=\"form-control\"\r\n            cols=\"30\"\r\n            rows=\"10\"\r\n            v-model=\"form.message\"\r\n          ></textarea>\r\n        </div>\r\n        <div class=\"text-end\">\r\n          <button class=\"btn btn-danger\">送出訂單</button>\r\n        </div>\r\n      </Form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport CouponModal from '@/components/CouponModal.vue';\r\nimport DelModal from '@/components/DelModal.vue';\r\n\r\nexport default {\r\n  components: { CouponModal, DelModal },\r\n  data() {\r\n    return {\r\n      products: [],\r\n      product: {},\r\n      status: {\r\n        loadingItem: ''\r\n      },\r\n      form: {\r\n        user: {\r\n          name: '',\r\n          email: '',\r\n          tel: '',\r\n          address: ''\r\n        },\r\n        productNames: '',\r\n        finalTotal: 0,\r\n        message: ''\r\n      },\r\n      cart: {\r\n        items: [],\r\n        total: 0,\r\n        final_total: 0\r\n      },\r\n      coupon_code: '',\r\n      appliedDiscount: 1,\r\n      coupons: []\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    discountedTotal() {\r\n      return this.cart.total * this.appliedDiscount;\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    'cart.items': {\r\n      deep: true,\r\n      handler() {\r\n        this.updateCartTotals();\r\n      }\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    async getProducts() {\r\n      const url = `/api/product-data`;\r\n      try {\r\n        const response = await this.$http.get(url);\r\n        this.products = response.data;\r\n      } catch (error) {\r\n        console.error(\"Error fetching products:\", error);\r\n      }\r\n    },\r\n\r\n    getProduct(id) {\r\n      this.$router.push(`/user/product/${id}`);\r\n    },\r\n\r\n    addCart(productID) {\r\n      const productToAdd = this.products.find(product => product.id === productID);\r\n      if (productToAdd) {\r\n        const existingItem = this.cart.items.find(item => item.product.id === productID);\r\n        if(existingItem) {\r\n          existingItem.qty++;\r\n        } else {\r\n          const cartItem = {\r\n            product: {\r\n              id: productToAdd.id,\r\n              title: productToAdd.title,\r\n              price: productToAdd.price || productToAdd.origin_price,\r\n              unit: productToAdd.unit\r\n            },\r\n            qty: 1\r\n          };\r\n          this.cart.items.push(cartItem);\r\n        }\r\n      }\r\n    },\r\n\r\n    removeCartItemByProductId(productId) {\r\n      this.cart.items = this.cart.items.filter(item => item.product.id !== productId);\r\n    },\r\n\r\n    updateCartQuantityByProductId(productId, qty) {\r\n      const item = this.cart.items.find(item => item.product.id === productId);\r\n      if(item) {\r\n        item.qty = qty;\r\n      }\r\n    },\r\n\r\n    async validateAndApplyCoupon() {\r\n      const url = `/api/coupons/validate/${this.coupon_code}`;\r\n      try {\r\n        const response = await this.$http.get(url);\r\n        const coupon = response.data;\r\n        if (coupon.isEnabled) {\r\n          this.appliedDiscount = 1 - (coupon.percent / 100);\r\n          this.cart.final_total = this.cart.total * this.appliedDiscount;\r\n        } else {\r\n          alert(\"此优惠券已被禁用！\");\r\n          this.appliedDiscount = 1;\r\n          this.cart.final_total = this.cart.total;\r\n        }\r\n      } catch (error) {\r\n        if (error.response && error.response.status === 404) {\r\n          alert(\"优惠券不存在！\");\r\n        } else {\r\n          alert(\"优惠券验证错误！\");\r\n        }\r\n        console.error(\"Error applying coupon:\", error);\r\n        this.appliedDiscount = 1;\r\n        this.cart.final_total = this.cart.total;\r\n      }\r\n    },\r\n\r\n    addCouponCode() {\r\n      this.validateAndApplyCoupon();\r\n    },\r\n\r\n    async createOrder() {\r\n  const productNames = this.cart.items.map(item => item.product.title).join(\", \");\r\n  const orderData = {\r\n    email: this.form.user.email,\r\n    recipientName: this.form.user.name,\r\n    recipientPhone: this.form.user.tel,\r\n    recipientAddress: this.form.user.address,\r\n    message: this.form.message,\r\n    productNames: productNames,\r\n    finalTotal: this.cart.final_total\r\n  };\r\n\r\n  const url = `/api/user_orders`;\r\n  try {\r\n    const response = await this.$http.post(url, orderData);\r\n    if (response.data && response.data.success) {\r\n      console.log(\"Order created successfully.\");\r\n    } else {\r\n      console.error(\"Order creation failed:\", response);\r\n      alert(\"訂單創建成功\");\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error creating order:\", error);\r\n    if (error.response && error.response.data) {\r\n      console.error(\"Server Response:\", error.response.data);\r\n      alert(\"服务器错误，请联系管理员。\");\r\n    } else {\r\n      alert(\"网络错误或服务器无响应。\");\r\n    }\r\n  } finally {\r\n    // 不论成功或失败，都跳转到订单页面\r\n    this.$router.push('/dashboard/orders');\r\n  }\r\n},\r\n    async getCoupons() {\r\n      const url = `/api/coupons`;\r\n      try {\r\n        const response = await this.$http.get(url);\r\n        this.coupons = response.data.map(coupon => ({\r\n          ...coupon,\r\n          due_date: coupon.dueDate\r\n        }));\r\n      } catch (error) {\r\n        console.error(\"Error fetching coupons:\", error);\r\n      }\r\n    },\r\n\r\n    updateCartTotals() {\r\n      this.cart.total = this.cart.items.reduce((acc, item) => acc + (item.product.price * item.qty), 0);\r\n      this.cart.final_total = this.cart.total * this.appliedDiscount;\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getProducts();\r\n    this.getCoupons();\r\n  },\r\n\r\n  filters: {\r\n    currency(value) {\r\n      return value.toLocaleString('zh-TW', { style: 'currency', currency: 'TWD' });\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
"use strict";(self["webpackChunkijrgoer"]=self["webpackChunkijrgoer"]||[]).push([[151],{2724:function(t,e,o){o.d(e,{Z:function(){return $}});var a=o(3396),l=o(9242);const s={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},n={class:"modal-dialog",role:"document"},r={class:"modal-content"},i=(0,a._)("div",{class:"modal-header"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),d={class:"modal-body"},c={class:"mb-3"},u=(0,a._)("label",{for:"title"},"標題",-1),p={class:"mb-3"},m=(0,a._)("label",{for:"coupon_code"},"優惠碼",-1),_={class:"mb-3"},h=(0,a._)("label",{for:"due_date"},"到期日",-1),b={class:"mb-3"},f=(0,a._)("label",{for:"price"},"折扣百分比",-1),y={class:"mb-3"},g={class:"form-check"},C=(0,a._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),v={class:"modal-footer"},w=(0,a._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function k(t,e,o,k,D,x){return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",n,[(0,a._)("div",r,[i,(0,a._)("div",d,[(0,a._)("div",c,[u,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=t=>D.tempCoupon.title=t),placeholder:"請輸入標題"},null,512),[[l.nr,D.tempCoupon.title]])]),(0,a._)("div",p,[m,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=t=>D.tempCoupon.code=t),placeholder:"請輸入優惠碼"},null,512),[[l.nr,D.tempCoupon.code]])]),(0,a._)("div",_,[h,(0,a.wy)((0,a._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=t=>D.due_date=t)},null,512),[[l.nr,D.due_date]])]),(0,a._)("div",b,[f,(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[3]||(e[3]=t=>D.tempCoupon.percent=t),placeholder:"請輸入折扣百分比"},null,512),[[l.nr,D.tempCoupon.percent,void 0,{number:!0}]])]),(0,a._)("div",y,[(0,a._)("div",g,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=t=>D.tempCoupon.is_enabled=t),id:"is_enabled"},null,512),[[l.e8,D.tempCoupon.is_enabled]]),C])])]),(0,a._)("div",v,[w,(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=e=>t.$emit("update-coupon",D.tempCoupon))},"增加新優惠券 ")])])])],512)}var D=o(1339),x={name:"couponModal",props:{coupon:{}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){if(this.tempCoupon=JSON.parse(JSON.stringify(this.coupon)),this.tempCoupon.due_date){const t=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=t}},due_date(){this.due_date&&(this.tempCoupon.due_date=Math.floor(new Date(this.due_date).getTime()/1e3))}},methods:{},mixins:[D.Z]},V=o(89);const q=(0,V.Z)(x,[["render",k]]);var $=q},5151:function(t,e,o){o.r(e),o.d(e,{default:function(){return at}});var a=o(3396),l=o(7139),s=o(9242);const n={class:"container"},r={class:"row mt-4"},i={class:"col-md-7"},d={class:"table align-middle"},c=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"圖片"),(0,a._)("th",null,"商品名稱"),(0,a._)("th",null,"價格"),(0,a._)("th")])],-1),u={style:{width:"200px"}},p={href:"#",class:"text-dark"},m={key:0,class:"h5"},_={key:1,class:"h6"},h={key:2,class:"h5"},b={class:"btn-group btn-group-sm"},f=["onClick"],y=["disabled","onClick"],g={key:0,class:"spinner-grow text-danger spinner-grow-sm",role:"status"},C=(0,a._)("span",{class:"visually-hidden"},"Loading...",-1),v=[C],w={class:"col-md-5"},k={class:"sticky-top"},D={class:"table align-middle"},x=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th"),(0,a._)("th",null,"品名"),(0,a._)("th",{style:{width:"110px"}},"數量"),(0,a._)("th",null,"單價"),(0,a._)("th",null,"總價")])],-1),V=["onClick"],q=(0,a._)("i",{class:"bi bi-x"},null,-1),$=[q],U={class:"input-group input-group-sm"},z=["onUpdate:modelValue","onChange"],W={class:"input-group-text"},E=(0,a._)("td",{colspan:"4",class:"text-end"},"總計",-1),I={class:"text-end"},P={key:0},S=(0,a._)("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),T={class:"text-end text-success"},M={class:"input-group mb-3 input-group-sm"},L={class:"input-group-append"},N={class:"my-5 row justify-content-center"},O={class:"mb-3"},Z=(0,a._)("label",{for:"email",class:"form-label"},"Email",-1),j={class:"mb-3"},A=(0,a._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),B={class:"mb-3"},H=(0,a._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={class:"mb-3"},F=(0,a._)("label",{for:"address",class:"form-label"},"收件人地址",-1),J={class:"mb-3"},K=(0,a._)("label",{for:"message",class:"form-label"},"留言",-1),Q=(0,a._)("div",{class:"text-end"},[(0,a._)("button",{class:"btn btn-danger"},"送出訂單")],-1);function R(t,e,o,C,q,R){const G=(0,a.up)("Loading"),X=(0,a.up)("Field"),tt=(0,a.up)("ErrorMessage"),et=(0,a.up)("Form");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(G,{active:t.isLoading},null,8,["active"]),(0,a._)("div",n,[(0,a._)("div",r,[(0,a._)("div",i,[(0,a._)("table",d,[c,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(q.products,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",u,[(0,a._)("div",{style:(0,l.j5)([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),(0,a._)("td",null,[(0,a._)("a",p,(0,l.zw)(t.title),1)]),(0,a._)("td",null,[t.price?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",m,(0,l.zw)(t.origin_price)+" 元 ",1)),t.price?((0,a.wg)(),(0,a.iD)("del",_," 原價 "+(0,l.zw)(t.origin_price)+" 元 ",1)):(0,a.kq)("",!0),t.price?((0,a.wg)(),(0,a.iD)("div",h," 現在只要 "+(0,l.zw)(t.price)+" 元 ",1)):(0,a.kq)("",!0)]),(0,a._)("td",null,[(0,a._)("div",b,[(0,a._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>R.getProduct(t.id)}," 查看更多 ",8,f),(0,a._)("button",{type:"button",class:"btn btn-outline-danger",disabled:this.status.loadingItem===t.id,onClick:e=>R.addCart(t.id)},[this.status.loadingItem===t.id?((0,a.wg)(),(0,a.iD)("div",g,v)):(0,a.kq)("",!0),(0,a.Uk)(" 加到購物車 ")],8,y)])])])))),128))])])]),(0,a._)("div",w,[(0,a._)("div",k,[(0,a._)("table",D,[x,(0,a._)("tbody",null,[q.cart.items.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(q.cart.items,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.product.id},[(0,a._)("td",null,[(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>R.removeCartItemByProductId(t.product.id)},$,8,V)]),(0,a._)("td",null,(0,l.zw)(t.product.title),1),(0,a._)("td",null,[(0,a._)("div",U,[(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":e=>t.qty=e,onChange:e=>R.updateCartQuantityByProductId(t.product.id,t.qty)},null,40,z),[[s.nr,t.qty,void 0,{number:!0}]]),(0,a._)("div",W," / "+(0,l.zw)(t.product.unit),1)])]),(0,a._)("td",null,(0,l.zw)(t.product.price)+" 元",1),(0,a._)("td",null,(0,l.zw)(t.product.price*t.qty)+" 元",1)])))),128)):(0,a.kq)("",!0)]),(0,a._)("tfoot",null,[(0,a._)("tr",null,[E,(0,a._)("td",I,(0,l.zw)(t.$filters.currency(q.cart.total)),1)]),q.cart.final_total!==q.cart.total?((0,a.wg)(),(0,a.iD)("tr",P,[S,(0,a._)("td",T,(0,l.zw)(t.$filters.currency(q.cart.final_total)),1)])):(0,a.kq)("",!0)])]),(0,a._)("div",M,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=t=>q.coupon_code=t),placeholder:"請輸入優惠碼"},null,512),[[s.nr,q.coupon_code]]),(0,a._)("div",L,[(0,a._)("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[1]||(e[1]=(...t)=>R.addCouponCode&&R.addCouponCode(...t))}," 套用優惠碼 ")])])])])]),(0,a._)("div",N,[(0,a.Wm)(et,{class:"col-md-6",onSubmit:R.createOrder},{default:(0,a.w5)((({errors:t})=>[(0,a._)("div",O,[Z,(0,a.Wm)(X,{id:"email",name:"email",type:"email",class:(0,l.C_)(["form-control",{"is-invalid":t["email"]}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:q.form.user.email,"onUpdate:modelValue":e[2]||(e[2]=t=>q.form.user.email=t)},null,8,["class","modelValue"]),(0,a.Wm)(tt,{name:"email",class:"invalid-feedback"})]),(0,a._)("div",j,[A,(0,a.Wm)(X,{id:"name",name:"姓名",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":t["姓名"]}]),placeholder:"請輸入姓名",rules:"required",modelValue:q.form.user.name,"onUpdate:modelValue":e[3]||(e[3]=t=>q.form.user.name=t)},null,8,["class","modelValue"]),(0,a.Wm)(tt,{name:"姓名",class:"invalid-feedback"})]),(0,a._)("div",B,[H,(0,a.Wm)(X,{id:"tel",name:"電話",type:"tel",class:(0,l.C_)(["form-control",{"is-invalid":t["電話"]}]),placeholder:"請輸入電話",rules:"required",modelValue:q.form.user.tel,"onUpdate:modelValue":e[4]||(e[4]=t=>q.form.user.tel=t)},null,8,["class","modelValue"]),(0,a.Wm)(tt,{name:"電話",class:"invalid-feedback"})]),(0,a._)("div",Y,[F,(0,a.Wm)(X,{id:"address",name:"地址",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":t["地址"]}]),placeholder:"請輸入地址",rules:"required",modelValue:q.form.user.address,"onUpdate:modelValue":e[5]||(e[5]=t=>q.form.user.address=t)},null,8,["class","modelValue"]),(0,a.Wm)(tt,{name:"地址",class:"invalid-feedback"})]),(0,a._)("div",J,[K,(0,a.wy)((0,a._)("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[6]||(e[6]=t=>q.form.message=t)},null,512),[[s.nr,q.form.message]])]),Q])),_:1},8,["onSubmit"])])])],64)}o(7658);var G=o(2724),X=o(7236),tt={components:{CouponModal:G.Z,DelModal:X.Z},data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},productNames:"",finalTotal:0,message:""},cart:{items:[],total:0,final_total:0},coupon_code:"",appliedDiscount:1,coupons:[]}},computed:{discountedTotal(){return this.cart.total*this.appliedDiscount}},watch:{"cart.items":{deep:!0,handler(){this.updateCartTotals()}}},methods:{async getProducts(){const t="/api/product-data";try{const e=await this.$http.get(t);this.products=e.data}catch(e){console.error("Error fetching products:",e)}},getProduct(t){this.$router.push(`/user/product/${t}`)},addCart(t){const e=this.products.find((e=>e.id===t));if(e){const o=this.cart.items.find((e=>e.product.id===t));if(o)o.qty++;else{const t={product:{id:e.id,title:e.title,price:e.price||e.origin_price,unit:e.unit},qty:1};this.cart.items.push(t)}}},removeCartItemByProductId(t){this.cart.items=this.cart.items.filter((e=>e.product.id!==t))},updateCartQuantityByProductId(t,e){const o=this.cart.items.find((e=>e.product.id===t));o&&(o.qty=e)},getCart(){},async validateAndApplyCoupon(){const t=`/api/coupons/validate/${this.coupon_code}`;try{const e=await this.$http.get(t),o=e.data;o.isEnabled?(this.appliedDiscount=1-o.percent/100,this.cart.final_total=this.cart.total*this.appliedDiscount):(alert("此優惠券已被禁用！"),this.appliedDiscount=1,this.cart.final_total=this.cart.total)}catch(e){e.response&&404===e.response.status?alert("優惠券不存在！"):alert("優惠券驗證出錯！"),console.error("Error applying coupon:",e),this.appliedDiscount=1,this.cart.final_total=this.cart.total}},addCouponCode(){this.validateAndApplyCoupon()},async createOrder(){const t=this.cart.items.map((t=>t.product.title)).join(", "),e={email:this.form.user.email,recipientName:this.form.user.name,recipientPhone:this.form.user.tel,recipientAddress:this.form.user.address,message:this.form.message,productNames:t,finalTotal:this.cart.final_total},o="/api/user_orders";try{const t=await this.$http.post(o,e);console.log(t)}catch(a){console.error("Error creating order:",a),a.response&&a.response.data&&console.error("Server Response:",a.response.data)}},async getCoupons(){const t="/api/coupons";try{const e=await this.$http.get(t);this.coupons=e.data.map((t=>({...t,due_date:t.dueDate})))}catch(e){console.error("Error fetching coupons:",e)}},formatDate(t){const e=new Date(t);return e.toLocaleDateString()},async updateOrCreateCoupon(t){this.isNew?await this.createCoupon(t):await this.updateCoupon(t)},async createCoupon(t){const e="/api/coupons";try{await this.$http.post(e,t),this.getCoupons()}catch(o){console.error("Error creating coupon:",o)}},async updateCoupon(t){const e=`/api/coupons/${t.id}`;try{await this.$http.put(e,t),this.getCoupons()}catch(o){console.error("Error updating coupon:",o)}},async delCoupon(){const t=`/api/coupons/${this.tempCoupon.id}`;try{await this.$http.delete(t),this.getCoupons()}catch(e){console.error("Error deleting coupon:",e)}},updateCartTotals(){this.cart.total=this.cart.items.reduce(((t,e)=>t+e.product.price*e.qty),0),this.cart.final_total=this.cart.total*this.appliedDiscount}},created(){this.getProducts(),this.getCoupons()},filters:{currency(t){return t.toLocaleString("zh-TW",{style:"currency",currency:"TWD"})}}},et=o(89);const ot=(0,et.Z)(tt,[["render",R]]);var at=ot}}]);
//# sourceMappingURL=151.089386a3.js.map